<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>PHP и COM</title>

 </head>
 <body><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="faq.html.html">PHP и HTML</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="faq.migration5.html">Переход с PHP 4 на PHP 5</a></div>
 <div class="up"><a href="faq.html">ЧАВО</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="faq.com" class="chapter">
  <h1>PHP и COM</h1>

  

   <p class="para">
    PHP может быть использован для доступа к COM и DCOM объектам на
    Win32 платформах.
   </p>

  <div class="qandaset"><ol class="qandaset_questions"><li><a href="#faq.com.q1">
     
      Я собрал DLL для кое-каких вычислений. Можно ли запустить эту DLL из PHP?
     
    </a></li><li><a href="#faq.com.q2">
     
      Что значит &#039;Unsupported variant type: xxxx (0xxxxx)&#039;?
     
    </a></li><li><a href="#faq.com.q3">
     
      Возможно ли манипулирование визуальными объектами в PHP?
     
    </a></li><li><a href="#faq.com.q4">
     
      Могу ли я сохранять COM объекты в сессии?
     
    </a></li><li><a href="#faq.com.q5">
     
      Как я могу поймать COM ошибки?
     
    </a></li><li><a href="#faq.com.q6">
     
      Можно ли генерировать DLL файлы из PHP скриптов как это можно делать в Perl?
     
    </a></li><li><a href="#faq.com.q7">
     
      Что значит
      &#039;Unable to obtain IDispatch interface for CLSID {xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx}&#039;?
     
    </a></li><li><a href="#faq.com.q8">
     
      Как можно запускать COM объекты с удаленного сервера?
     
    </a></li><li><a href="#faq.com.q9">
     
      Я получаю &#039;DCOM is disabled in C:\path...\scriptname.php on line 6&#039;,
      что делать?
     
    </a></li><li><a href="#faq.com.q10">
     
      Возможно ли с помощью PHP загрузить/манипулировать ActiveX объектом на странице?
     
    </a></li><li><a href="#faq.com.q11">
     
      Возможно ли получить выполняющийся экземпляр компонента?
     
    </a></li><li><a href="#faq.com.q12">
     
      Есть ли способ обработать событие, посланное COM объектом?
     
    </a></li><li><a href="#faq.com.q13">
     
      У меня возникают проблемы при попытке вызвать метод COM объекта,
      который предоставляет более чем один интерфейс. Что я могу сделать?
     
    </a></li><li><a href="#faq.com.q14">
     
      Значит PHP работает с COM, как насчет COM+?
     
    </a></li><li><a href="#faq.com.q15">
     
      Если PHP может манипулировать COM объектами, можно ли представить себе
      использование MTS для управления ресурсами компонентов
      в соединении с PHP?
     
    </a></li></ol></div>
   <dl class="qandaentry" id="faq.com.q1">
    <dt><strong>
     
      Я собрал DLL для кое-каких вычислений. Можно ли запустить эту DLL из PHP?
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      Если это простая DLL, то пока еще нет возможности вызвать её из PHP.
      Если DLL содержит COM сервер, то вы можете получить доступ к ней, если
      она реализует интерфейс IDispatch.
     </p>
    </dd>
   </dl>
   
   <dl class="qandaentry" id="faq.com.q2">
    <dt><strong>
     
      Что значит &#039;Unsupported variant type: xxxx (0xxxxx)&#039;?
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      Существуют дюжины VARIANT типов и их комбинаций. Большинство из них уже
      поддерживаются, но несколько все еще не реализованы.
      Массивы поддерживаются не полностью. Только одномерные индексированные
      массивы могут передаваться между PHP и COM. Если вы обнаружите неподдерживаемые
      типы, пожалуйста, сообщите о них как об ошибке (если это еще не сделано)
      и предоставьте всю доступную информацию.
     </p>
    </dd>
   </dl>
  
   <dl class="qandaentry" id="faq.com.q3">
    <dt><strong>
     
      Возможно ли манипулирование визуальными объектами в PHP?
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      В общем да, но так как PHP в основном используется как скриптовый язык для
      web и выполняется в контексте web сервера, то визуальные объекты никогда
      не появятся на рабочем столе (desktop) сервера. Если вы используете PHP как
      скрипт для приложений, например в связке с PHP-GTK, тогда нет ограничений
      на доступ и манипулирование визуальными объектами через COM.
     </p>
    </dd>
   </dl>
  
   <dl class="qandaentry" id="faq.com.q4">
    <dt><strong>
     
      Могу ли я сохранять COM объекты в сессии?
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      Нет, не можете. Так как экземпляры COM объектов рассматриваются
      как ресурсы, то они доступны только в контексте одного скрипта.
     </p>
    </dd>
   </dl>
  
   <dl class="qandaentry" id="faq.com.q5">
    <dt><strong>
     
      Как я могу поймать COM ошибки?
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      В PHP 5 COM расширение возбуждает исключение
      <em>com_exception</em>, которое вы можете перехватить
      и затем проверить поле <em>code</em> для того, чтобы
      определить что делать дальше.
     </p>
     <p class="para">
      В PHP 4 поймать COM ошибки средствами, отличными от тех, что предлагает
      сам PHP (@, track_errors, ...) невозможно.
     </p>
    </dd>
   </dl>
  
   <dl class="qandaentry" id="faq.com.q6">
    <dt><strong>
     
      Можно ли генерировать DLL файлы из PHP скриптов как это можно делать в Perl?
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      Нет, к сожалению такое средство недоступно для PHP.
     </p>
    </dd>
   </dl>
  
   <dl class="qandaentry" id="faq.com.q7">
    <dt><strong>
     
      Что значит
      &#039;Unable to obtain IDispatch interface for CLSID {xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx}&#039;?
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      Эта ошибка может возникнуть по разным причинам:
      <ul class="itemizedlist">
       <li class="listitem">
         <span class="simpara">
         неправильный CLSID
         </span>
        </li>
       <li class="listitem">
         <span class="simpara">
         отсутствует запрошенная DLL
         </span>
        </li>
       <li class="listitem">
         <span class="simpara">
         запрошенный компонент не реализует интерфейс IDispatch
         </span>
        </li>
       </ul>
     </p>
    </dd>
   </dl>
    
   <dl class="qandaentry" id="faq.com.q8">
    <dt><strong>
     
      Как можно запускать COM объекты с удаленного сервера?
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      Точно так же как вы запускаете локальные объекты. Вам только надо передать
      IP удаленной машины как второй параметер COM конструктора.
     </p>
     <p class="para">
      Убедитесь, что в вашем <var class="filename">php.ini</var> вы установили
      <a href="com.configuration.html#ini.com.allow-dcom" class="link">com.allow_dcom</a><em>=</em><strong><code>TRUE</code></strong>
     </p>
    </dd>
   </dl>
   
   <dl class="qandaentry" id="faq.com.q9">
    <dt><strong>
     
      Я получаю &#039;DCOM is disabled in C:\path...\scriptname.php on line 6&#039;,
      что делать?
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      Отредактируйте ваш <var class="filename">php.ini</var> и установите
      <a href="com.configuration.html#ini.com.allow-dcom" class="link">com.allow_dcom</a><em>=</em><strong><code>TRUE</code></strong>.
     </p>
    </dd>
   </dl>
   
   <dl class="qandaentry" id="faq.com.q10">
    <dt><strong>
     
      Возможно ли с помощью PHP загрузить/манипулировать ActiveX объектом на странице?
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      PHP здесь не причем. ActiveX объекты загружаются на стороне клиента,
      если они были запрошены из HTML документа. Связи с PHP скриптом нет и,
      следовательно, прямое взаимодействие с серверной стороной невозможно.
     </p>
    </dd>
   </dl>
   <dl class="qandaentry" id="faq.com.q11">
    <dt><strong>
     
      Возможно ли получить выполняющийся экземпляр компонента?
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      Это возможно с помощью моникеров. Если вы хотите получить несколько
      ссылок на один и тот же экземпляр Word, вы можете создать этот экземпляр
      как показано:
     </p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$word&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">COM</span><span style="color: #007700">(</span><span style="color: #DD0000">"C:\docs\word.doc"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

     <p class="para">
      Это создаст новый экземпляр, если нет доступного выполняющегося экземпляра
      или будет возвращена ссылка на выполняющийся экземпляр, если таковой доступен.
     </p>
    </dd>
   </dl>
   <dl class="qandaentry" id="faq.com.q12">
    <dt><strong>
     
      Есть ли способ обработать событие, посланное COM объектом?
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      Используя <span class="function"><a href="function.com-event-sink.html" class="function">com_event_sink()</a></span> вы можете определить
      приемник события и привязать его. Вы можете заставить PHP сгенерировать
      скелет класса приемника событий, используя
      <span class="function"><a href="function.com-print-typeinfo.html" class="function">com_print_typeinfo()</a></span>.
     </p>
    </dd>
   </dl>
   
   <dl class="qandaentry" id="faq.com.q13">
    <dt><strong>
     
      У меня возникают проблемы при попытке вызвать метод COM объекта,
      который предоставляет более чем один интерфейс. Что я могу сделать?
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      Ответ так же прост как и неудовлетворителен. Не знаю точно, но думаю,
      что вы не можете ничего сделать. Если у кого-то есть точная
      информация по этому вопросу, пожалуйста, дайте
      <a href="mailto:harald.radi@nme.at" class="link external">&raquo;&nbsp;мне</a> знать :)
     </p>
    </dd>
   </dl>
   
   <dl class="qandaentry" id="faq.com.q14">
    <dt><strong>
     
      Значит PHP работает с COM, как насчет COM+?
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      COM+ расширяет COM, предоставляя систему для управления компонентами
      через MTS и MSMQ, но здесь нет ничего особенного, что PHP должен
      поддерживать для использования таких компонент.
     </p>
    </dd>
   </dl>
   
   <dl class="qandaentry" id="faq.com.q15">
    <dt><strong>
     
      Если PHP может манипулировать COM объектами, можно ли представить себе
      использование MTS для управления ресурсами компонентов
      в соединении с PHP?
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      Сам PHP еще не обрабатывает транзакции. Таким образом, если возникает
      ошибка, откат не инициируется. Если вы используете компоненты,
      поддерживающие транзакции, вам будет необходимо реализовать
      управление транзакциями самим.
     </p>
    </dd>
   </dl>
 
  
 </div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="faq.html.html">PHP и HTML</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="faq.migration5.html">Переход с PHP 4 на PHP 5</a></div>
 <div class="up"><a href="faq.html">ЧАВО</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
